import{w as Z}from"./with-props-BMOtgW5C.js";import{o as e,a as r}from"./chunk-D4RADZKF-BXVSF3ox.js";function z({Name:y,Ticker:l,Amount:x,Image:t}){return e.jsxs("div",{className:"Home-Content-Info-Coins-Coin",children:[e.jsx("img",{className:"Home-Content-Info-Coins-Coin-Image",src:t}),e.jsxs("div",{className:"coin-info-vertical",children:[e.jsxs("span",{className:"Home-Content-Info-Coins-Coin-Ticker",children:["$",l]}),e.jsxs("div",{className:"coin-info-bottom",children:[e.jsxs("span",{className:"Home-Content-Info-Coins-Coin-Name",children:["Name: ",y]}),e.jsxs("span",{className:"Home-Content-Info-Coins-Coin-Amount",children:["Amount: ",x]})]})]})]})}function G({}){return[{title:"Solana Savings"},{name:"description",content:""}]}const Q=Z(function(){const[l,x]=r.useState(""),[t,j]=r.useState(null),[S,F]=r.useState(),[p,k]=r.useState(!1),[w,H]=r.useState(""),[g,v]=r.useState(9),[I,E]=r.useState(!1);r.useEffect(()=>{M()},[]),r.useEffect(()=>{console.log(t)},[t]);async function M(){const o=await(await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd")).json();F(o.solana.usd)}const O=s=>new Promise(o=>setTimeout(o,s));async function D(s,o=3){let n=0;for(;n<o;)try{await O(150*Math.pow(2,n));const a=await fetch("https://zkcomp-viewer-production.up.railway.app/api/tokenInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tokenAddress:s})});if(a.ok)return await a.json();throw new Error("Failed to fetch token info")}catch(a){if(n++,n===o)throw a}}async function $(){var a;if(!t||I)return;E(!0);const s=[...t.items],o=g,n=Math.min(o+9,s.length);for(let m=o;m<n;m++){const i=s[m];if((a=i.tokenData)!=null&&a.mint)try{const f=await D(i.tokenData.mint);s[m]={...i,tokenInfo:f},j(d=>d?{...d,items:s}:null)}catch(f){console.error(`Error fetching tokenInfo for ${i.tokenData.mint}`,f)}}v(n),E(!1)}async function _(s){var n,a,m;const o={walletAddress:s};k(!0),H(""),v(9);try{const i=await fetch("https://zkcomp-viewer-production.up.railway.app/api/getAccountInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const c=await i.json();throw new Error(`Server error: ${c.error||"Unknown error"}`)}const d=((a=(n=(await i.json()).result)==null?void 0:n.value)==null?void 0:a.items)||[],u=d.length,L=40,P=926,U=u*L+(u?128:0),T=u*L*3480*2,K=u*(P+128),b=u*P*3480*2,W={address:s,numAssets:u,compressedBytes:U,compressedCost:T/1e9,uncompressedBytes:K,uncompressedCost:b/1e9,savings:(b-T)/1e9,items:d.map(c=>({...c}))};j(W);const h=[...d];for(let c=0;c<Math.min(9,h.length);c++){const C=h[c];if((m=C.tokenData)!=null&&m.mint)try{const N=await D(C.tokenData.mint);h[c]={...C,tokenInfo:N},j(B=>B?{...B,items:h}:null)}catch(N){console.error(`Error fetching tokenInfo for ${C.tokenData.mint}`,N)}}}catch(i){H(i.message||"Failed to fetch account info.")}finally{k(!1)}}const A=()=>{l.trim()&&!p&&_(l.trim())},R=s=>{s.key==="Enter"&&A()};return e.jsxs("div",{className:"Home",children:[e.jsx("div",{className:"Home-Header",children:e.jsx("span",{className:"Home-Header-Name",children:"solsavings"})}),e.jsxs("div",{className:"Home-Content",children:[e.jsx("span",{className:"Home-Content-Title",children:"Compression Profiler"}),e.jsx("span",{className:"Home-Content-Desc",children:"Discover how much you're saving with ZK Compression on Solana"}),e.jsx("span",{className:"Home-Content-Amount",children:t!=null&&S?`${t.savings.toFixed(4)} SOL, $${(S*t.savings).toFixed(3)}`:"0 SOL, $0"}),e.jsxs("div",{className:"Home-Content-Input",children:[e.jsx("input",{className:"Home-Content-Input-Text",placeholder:"Enter Solana Wallet Address",value:l,onChange:s=>x(s.target.value),onKeyPress:R}),e.jsx("button",{className:"Home-Content-Input-Button",onClick:A,disabled:p||!l.trim(),children:p?"Loading...":"Submit"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"Home-Content-Info",children:[p&&e.jsx("span",{children:"Loading..."}),w&&e.jsx("span",{style:{color:"red"},children:w}),e.jsxs("span",{className:"Home-Content-Info-Address",children:["Number of Assets: ",t.numAssets]}),e.jsxs("span",{className:"Home-Content-Info-Assets",children:["Compressed Bytes: ",t.compressedBytes]}),e.jsxs("span",{className:"Home-Content-Info-CBytes",children:["Uncompressed Bytes: ",t.uncompressedBytes]}),e.jsxs("span",{className:"Home-Content-Info-Bytes",children:["Compressed Cost: ",t.compressedCost.toFixed(4)," SOL"]}),e.jsxs("span",{className:"Home-Content-Info-CCost",children:["Uncompressed Cost: ",t.uncompressedCost.toFixed(4)," SOL"]})]}),e.jsx("div",{className:"Home-Content-Info-Coins",children:t.items.slice(0,g).map((s,o)=>{const{tokenInfo:n,tokenData:a}=s;return n?e.jsx(z,{Image:n.imageUri,Name:n.name,Ticker:n.ticker,Amount:(a.amount/Math.pow(10,n.decimals||0)).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6})},o):null})}),t&&g<t.items.length&&e.jsx("button",{className:"Home-Content-LoadMore",onClick:$,disabled:I,children:I?"Loading...":"Load More"})]})]}),e.jsx("div",{className:"Home-Footer",children:e.jsx("span",{className:"Home-Footer-Text",children:"Built by NAB Labs"})})]})});export{Q as default,G as meta};
